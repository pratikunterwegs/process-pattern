---
editor_options: 
  chunk_output_type: console
---

# Plot repeatability over growth rates

```{r}
library(data.table)
library(ggplot2)
library(colorspace)
library(patchwork)
```

```{r}
source("R/fun_wt_vals.R")
```

## Load repeatability

```{r}
# load data
data = fread("data/data_repeatability.csv")
```

## Plot repeatability

```{r}
data = split(data, by = "type")

rpt_plots = lapply(data, function(df) {
  ggplot(df)+
    geom_vline(
      xintercept = c(0.0033, 0.03),
      col = 2,
      lty = 2
    )+
    geom_pointrange(
      aes(
        growth, 
        rpt_v,
        ymin = rpt_v - rpt_se,
        ymax = rpt_v + rpt_se,
        fill = growth
      ),
      alpha = 0.9,
      shape = 21,
      position = position_jitter(
        width = 0.01
      ),
      show.legend = F
    )+
    scale_fill_continuous_qualitative(
      palette = "Harmonic",
      trans = "log10",
      # begin = 0.1,
      end = 1
    )+
    scale_x_log10()+
    # facet_wrap(~ type,
    #            ncol = 3,
    #            scales = "free_y",
    #            labeller = labeller(
    #              type = c(
    #                "exploit" = "Exploit. comp.",
    #                "interf" = "Interf. comp.",
    #                "random" = "Random. move"
    #              )
    #            )
    # )+
    theme_classic(
      base_size = 10
    )+
    theme(
      strip.background = element_blank(),
      strip.text = element_text(
        face = "italic"
      ),
      axis.title.x = ggtext::element_markdown(),
      panel.grid.major.y = element_line(
        colour = "grey",
        # size = 0.4,
        linetype = 2
      )
    )+
    coord_cartesian(
      expand = F,
      xlim = c(0.9 * 1e-3, 0.035),
      ylim = c(0, 1)
    )+
    labs(
      x = "Landscape productivity *r<sub>max</sub>*",
      y = "Repeatability (+/- SE)"
    )
}
)
```

```{r}
fig_rpt = 
  wrap_plots(
    rpt_plots,
    ncol = 2
  ) +
  plot_annotation(
    tag_levels = "A"
  ) &
  theme(
    plot.tag = element_text(
      face = "bold"
    )
  )

ggsave(
  fig_rpt,
  filename = "figures/fig_repeatability.png",
  width = 5.2,
  height = 3
)
```

