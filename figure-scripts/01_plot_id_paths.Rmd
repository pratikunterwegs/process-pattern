---
editor_options: 
  chunk_output_type: console
---

# Plot variation within and between scenarios

```{r}
library(data.table)
library(ggplot2)
library(colorspace)
library(patchwork)
```

## Figures for movement paths

```{r}
data = fread("data/data_lt_plot.csv")[growth == 0.01,]
```

```{r}
data = split(data, by = c("type"))
```

```{r}
label_interval = c(
  "1000" = "T:   500 - 1,500",
  "3000" = "T: 2,500 - 3,500",
  "6000" = "T: 5,500 - 6,500",
  "8000" = "T: 7,500 - 8,500"
)

make_id_plots = function(df, type) {
  ggplot(df)+
    geom_hline(
      yintercept = 0, size = 0.1, col = "grey",
      lty = 2
    )+
    geom_vline(
      xintercept = 0, size = 0.1, col = "grey",
      lty = 2
    )+
  geom_path(
    aes(x_wrap, y_wrap,
        group = interaction(id, interval),
        col = factor(id)),
    show.legend = F
  )+
  scale_color_discrete_qualitative(
  )+
  facet_wrap(
    ~interval,
    ncol = 2,
    labeller = labeller(
      interval = label_interval
    )
  )+
  coord_cartesian(
    xlim = c(-70, 70),
    ylim = c(-70, 70),
    expand = F
  )+
  theme(
    strip.text = element_text(
      face = "italic"
    ),
    # axis.text = element_blank(),
    axis.title = element_blank(),
    # axis.ticks = element_blank(),
    panel.grid = element_blank()
  )+
  labs(
    title = sprintf("Scenario:%s", type)
  )
}
```


```{r}
plots = Map(data, names(data), f = make_id_plots)

plot_move = wrap_plots(
  plots[c("exploit", "interf")],
  ncol = 1
)
```

## Figures for path statistics

```{r}
data_stats = fread("data/data_lt_path_summaries.csv")

plot_dist_hist = 
  ggplot(data_stats[interval %in% c(1000, 3000, 6000, 8000) & type != "random"])+
  geom_vline(
    xintercept = 250,
    col = "red",
    lty = 2,
    size = 0.2
  )+
  geom_histogram(
    aes(distance),
    fill = "steelblue"
  )+
  facet_wrap(~type, ncol = 1, scales = "free_x")+
  theme_classic()+
  theme(
    strip.background = element_blank(),
    strip.text = element_text(
      face = "italic"
    ),
    # axis.text = element_blank(),
    # axis.title = element_blank(),
    # axis.ticks = element_blank(),
    panel.grid.minor = element_blank()
  )+
  coord_cartesian(
    expand = F,
    xlim = c(0, 1000),
    ylim = c(0, 200)
  )+
  labs(
    y = "# Tracks",
    x = "Distance"
  )
```

## Plot weights distribution

```{r}
wt_data = fread("data/data_lt_wt_gens.csv")
wt_data = wt_data[, c("id", "growth", "type", "rep_", 
                      sprintf("wt_%i", c(2, 3, 4)))]

setnames(wt_data, old = c("wt_2", "wt_3", "wt_4"), 
         new = c("sN", "sH", "sP"))
wt_data = melt(wt_data, id.vars = c("id", "growth", "type", "rep_"))

# scale wts
wt_data[, value := cut_wt_lower(value, steps = 100, scale = 20)]

wt_data = wt_data[, list(pW = .N / 1000), by = c("growth", "type", "rep_", "variable", "value")]
wt_data[, col := case_when(
  variable == "sN" ~ "red",
  variable == "sH" ~ "darkblue",
  variable == "sP" ~ "darkgreen"
)]
```

```{r}
plot_wt_dist = 
  ggplot(wt_data[growth == 0.01 & type != "random" & pW >= 0.01])+
  geom_hline(
    yintercept = 0, lty = 2,
    col = "grey"
  )+
  geom_tile(
    aes(
      variable, value,
      fill = variable,
      alpha = pW
    ),
    show.legend = F
  )+
  scale_fill_discrete_qualitative(
    # trans = "log10",
    # palette = "Harmonic", rev = F
    # limits = c(0.01, NA),
    # na.value = "transparent"
  )+
  scale_alpha_continuous(
    range = c(0.5, 1), trans = "sqrt"
  )+
  theme_classic()+
  theme(
    strip.background = element_blank(),
    strip.text = element_text(
      face = "italic"
    ),
    # axis.text = element_blank(),
    # axis.title = element_blank(),
    # axis.ticks = element_blank(),
    panel.grid.minor = element_blank()
  )+
  facet_wrap(~type, scales = "free_y", ncol = 2)+
  coord_cartesian(ylim = c(-1, 1))+
  labs(
    x = "Movement weight",
    y = "Weight value"
  )
```


## Wrap all plots

```{r}
fig_id_var =
  wrap_plots(
    plot_move,
    plot_dist_hist,
    plot_wt_dist,
    ncol = 2,
    design = "AAB\nAAC"
  )

ggsave(
  plot = fig_id_var,
  filename = "figures/fig_id_variation_distance.png",
  width = 6,
  height = 8
)
```

