---
editor_options: 
  chunk_output_type: console
---

# Vis evolved paths agent paths over generations

```{r}
# load libraries
library(data.table)
library(glue)
library(stringr)

library(ggplot2)
library(patchwork)

# source funs
source("R/fun_dist_disp.R")
source("R/fun_read_pos.R")
source("R/fun_steplength_timescale.R")
source("R/fun_read_config.R")
source("R/fun_link_landscape.R")
```

## List files and read data

needs to be made recursive over dirs.

```{r}
paths = list.dirs(path = "data", recursive = F)
paths = paths[grep("sim", paths)]

# select reps 002
paths = paths[grep("rep_002", paths)]
```

## Read parameters

```{r}
params = lapply(paths, read_config)
```

## Select individual paths

```{r}
data_id = lapply(paths, function(path) {
  fread(glue("{path}/00250_pos.csv"))[id < 4,]
})

# link params
data_id = Map(data_id, params, f = function(df, p) {
  df[, names(p) := list(p["growth"], p["type"], p["rep_"])]
  df
})

# bind
data_id = rbindlist(data_id)
data_id[, day := cumsum(t %% 100 == 0), by = c("id", "rep_", "growth", "type")]
data_id[, interval := cumsum(t %% 1000 == 0), by = c("id", "rep_", "growth", "type")]

data_id = data_id[interval %in% c(1,3,6,8)]

data_id = split(data_id, by = c("id", "interval", "growth", "type", "rep_"))

# transform paths using first point as origin to handle wrapping
data_id = lapply(data_id, function(df) {
  setorder(df, t)
  df$x_wrap = scale_wrap_coords(df$x) + rnorm(length(df$x), 0, 0.3)
  df$y_wrap = scale_wrap_coords(df$y) + rnorm(length(df$x), 0, 0.3)
  df
})

# bind
data_id = rbindlist(data_id)
```

```{r}
prod = read_landscape("data/data_parameters/kernels32.png")
data_id = link_landscape(data_id, prod)
setorder(data_id, id, t)
```

```{r}
fwrite(data_id, file = "data/data_lt_plot.csv")
```
